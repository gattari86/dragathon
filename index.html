<!DOCTYPE html>
<html>
<head>
    <style>
        /* Previous styles remain the same */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #2C0337, #1A0125);
            color: #fff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        /* ... rest of the styles ... */
    </style>
</head>
<body>
    <h1 id="gameTitle">üëë DRAGATHON üëë</h1>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <div class="controls">
        ‚¨ÖÔ∏è ‚û°Ô∏è Move | Space to Jump | Z to Pose | Collect all items to win! ‚ú®
    </div>
    <div id="startScreen">
        <h2>Welcome to Dragathon!</h2>
        <p>Collect all the fabulous items while serving looks!</p>
        <button onclick="startGame()">Start Serving!</button>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game constants
        const GRAVITY = 0.8;
        const GAME_STATE = {
            TITLE: 0,
            PLAYING: 1,
            PAUSED: 2,
            GAME_OVER: 3
        };

        // Game variables
        let currentState = GAME_STATE.TITLE;
        let level = 1;
        let totalScore = 0;
        let timeLeft = 60;

        // Player object
        const player = {
            x: 100,
            y: 300,
            width: 50,
            height: 80,
            speed: 6,
            jumpForce: -15,
            velY: 0,
            isJumping: false,
            facingRight: true,
            powerUps: [],
            poses: ['üíÉ', '‚ú®', 'üëë', 'üíÖ'],
            currentPose: 0,
            isPosing: false
        };

        // Platforms array
        const platforms = [
            {x: 0, y: 380, width: 800, height: 20, color: '#FF69B4'},
            {x: 200, y: 300, width: 100, height: 20, color: '#FFD700'},
            {x: 400, y: 250, width: 100, height: 20, color: '#FF69B4'},
            {x: 600, y: 200, width: 100, height: 20, color: '#FFD700'},
            {x: 300, y: 150, width: 100, height: 20, color: '#FF69B4'}
        ];

        // Accessories array
        const accessories = [
            {x: 250, y: 260, width: 30, height: 30, type: 'üëë', collected: false},
            {x: 450, y: 210, width: 30, height: 30, type: 'üë†', collected: false},
            {x: 650, y: 160, width: 30, height: 30, type: 'üíÑ', collected: false},
            {x: 350, y: 110, width: 30, height: 30, type: 'üíÖ', collected: false}
        ];

        // Power-ups
        const powerUps = {
            DOUBLE_POINTS: "üëë",
            SPEED_BOOST: "‚ö°",
            SUPER_JUMP: "üåü"
        };

        // Audio context
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(frequency, duration) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            
            oscillator.start();
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function showPhrase(x, y, text) {
            const div = document.createElement('div');
            div.className = 'phrase';
            div.style.left = `${x}px`;
            div.style.top = `${y}px`;
            div.textContent = text;
            document.body.appendChild(div);
            
            let pos = y;
            const animate = () => {
                pos -= 2;
                div.style.top = `${pos}px`;
                div.style.opacity = (y - pos < 100) ? 1 : 0;
                
                if (y - pos < 150) {
                    requestAnimationFrame(animate);
                } else {
                    div.remove();
                }
            };
            animate();
        }

        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        function drawPlayer() {
            // Draw the player with all previous styling
            // ... (previous drawPlayer code) ...
        }

        function updateGame() {
            if (currentState !== GAME_STATE.PLAYING) return;

            timeLeft -= 1/60;
            if (timeLeft <= 0) {
                currentState = GAME_STATE.GAME_OVER;
                return;
            }

            // Update player physics using the GRAVITY constant
            player.velY += GRAVITY;
            player.y += player.velY;

            // Platform collisions
            platforms.forEach(platform => {
                if (checkCollision(player, platform)) {
                    if (player.velY > 0) {
                        player.isJumping = false;
                        player.velY = 0;
                        player.y = platform.y - player.height;
                    }
                }
            });

            // Accessory collection
            accessories.forEach(acc => {
                if (!acc.collected && checkCollision(player, acc)) {
                    acc.collected = true;
                    totalScore += 100;
                    showPhrase(acc.x, acc.y - 30, "Fabulous! ‚ú®");
                    playSound(660, 0.1);
                }
            });
        }

        function drawGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw platforms
            platforms.forEach(platform => {
                ctx.fillStyle = platform.color;
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            });

            // Draw accessories
            accessories.forEach(acc => {
                if (!acc.collected) {
                    ctx.font = '30px Arial';
                    ctx.fillText(acc.type, acc.x, acc.y + 25);
                }
            });

            // Draw player
            drawPlayer();

            // Draw HUD
            ctx.fillStyle = '#FFF';
            ctx.font = 'bold 24px Arial';
            ctx.fillText(`Score: ${totalScore}`, 20, 40);
            ctx.fillText(`Level: ${level}`, 20, 70);
            ctx.fillText(`Time: ${Math.ceil(timeLeft)}`, canvas.width - 120, 40);

            if (currentState === GAME_STATE.GAME_OVER) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#FF69B4';
                ctx.font = 'bold 48px Arial';
                ctx.fillText('Game Over!', canvas.width/2 - 120, canvas.height/2);
                ctx.font = 'bold 24px Arial';
                ctx.fillText('Press SPACE to try again', canvas.width/2 - 120, canvas.height/2 + 50);
            }
        }

        function gameLoop() {
            updateGame();
            drawGame();
            requestAnimationFrame(gameLoop);
        }

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            currentState = GAME_STATE.PLAYING;
            timeLeft = 60;
            totalScore = 0;
            level = 1;
            player.x = 100;
            player.y = 300;
            accessories.forEach(acc => acc.collected = false);
            gameLoop();
        }

        // Keyboard controls
        const keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if (e.code === 'Space' && !player.isJumping) {
                player.velY = player.jumpForce;
                player.isJumping = true;
                playSound(440, 0.1);
                showPhrase(player.x, player.y - 50, "Werk! ‚ú®");
            }

            if (e.key === 'z' && !player.isPosing) {
                player.isPosing = true;
                player.currentPose = (player.currentPose + 1) % player.poses.length;
                showPhrase(player.x, player.y - 50, `Serving! ${player.poses[player.currentPose]}`);
                playSound(550, 0.1);
                setTimeout(() => player.isPosing = false, 1000);
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        function updatePlayerPosition() {
            if (keys['ArrowLeft']) {
                player.x -= player.speed;
                player.facingRight = false;
            }
            if (keys['ArrowRight']) {
                player.x += player.speed;
                player.facingRight = true;
            }
            
            // Keep player in bounds
            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width - player.width) {
                player.x = canvas.width - player.width;
            }
        }

        setInterval(updatePlayerPosition, 1000/60);

        // Initialize game
        window.onload = () => {
            document.getElementById('startScreen').style.display = 'block';
        };
    </script>
</body>
</html>